<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>School Summary</title>
  <style>
    *{box-sizing:border-box;margin:0;padding:0}
    body{
      font-family: "Segoe UI", sans-serif;
      background: url('https://i.imgur.com/lS5zbQD.png') no-repeat center center/cover;
      color:#fff; min-height:100vh;
      display:flex; flex-direction:column; align-items:center;
    }
    .login-box{
      margin:auto; background:rgba(0,0,0,0.7);
      padding:25px; border-radius:12px; text-align:center;
      width:300px;
    }
    input, textarea{width:100%;padding:10px;margin:10px 0;border-radius:8px;border:none}
    button{padding:10px 20px;border:none;border-radius:8px;background:#0d6efd;color:#fff;font-weight:bold;cursor:pointer}
    button:hover{background:#0b5ed7}
    h1{margin:20px 0;text-align:center;color:#FFD700;font-weight:900}
    h2{margin:15px 0;color:#FFD700}
    .summary{background:rgba(0,0,0,0.55);padding:15px;border-radius:12px;margin:10px 0}
    .summary p{margin:6px 0;color:#f5f5f5}
    .summary strong{color:#ffeb3b}
    .summary img{max-width:100%;margin-top:10px;border-radius:8px}
    .delete-btn{background:red;margin-top:8px}
    .form-box{background:rgba(0,0,0,0.6);padding:20px;border-radius:12px;margin:20px auto;width:90%;max-width:600px;display:none}
    footer{margin-top:auto;padding:15px;color:#ccc;text-align:center}
  </style>
</head>
<body>

  <!-- Login Page -->
  <div id="loginPage" class="login-box">
    <h2>School Summary Login</h2>
    <input type="password" id="password" placeholder="Enter Password">
    <button onclick="login()">Login</button>
  </div>

  <!-- Main Content -->
  <div id="mainPage" style="display:none;width:100%;max-width:900px;">
    <h1>üìò SCHOOL DAILY SUMMARY</h1>

    <!-- Admin post form -->
    <div class="form-box" id="postForm">
      <h2>Post a New Summary</h2>
      <input id="date" placeholder="Date (e.g. 16 Sept 2025)">
      <input id="subject" placeholder="Subject (e.g. Math)">
      <input id="page" placeholder="Page (e.g. 22)">
      <input id="exercise" placeholder="Exercise (e.g. Exercise 5)">
      <textarea id="text" rows="3" placeholder="Summary text..."></textarea>
      <input type="file" id="image" accept="image/*">
      <button id="postBtn">Post Summary</button>
    </div>

    <!-- Summaries list -->
    <div id="summaries-container">Loading summaries...</div>

    <footer>Made by pros tech ‚ò†Ô∏èüíÄ for our class‚ô•Ô∏è </footer>
  </div>

  <!-- Firebase Scripts -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.3/firebase-app.js";
    import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc } from "https://www.gstatic.com/firebasejs/10.12.3/firebase-firestore.js";
    import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.12.3/firebase-storage.js";

    const firebaseConfig = {
      apiKey: "AIzaSyBVB4lJbsI4KLmmtNv_zZHih52KLwsdmgs",
      authDomain: "schoolsummary-7d349.firebaseapp.com",
      projectId: "schoolsummary-7d349",
      storageBucket: "schoolsummary-7d349.firebasestorage.app",
      messagingSenderId: "539872820684",
      appId: "1:539872820684:web:b7a40f285c4d03e38fb169",
      measurementId: "G-37321WVRG4"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const storage = getStorage(app);

    let userRole = null; // "student" or "admin"

    window.login = function() {
      const password = document.getElementById("password").value;
      if (password === "Tba") {
        userRole = "student";
        sessionStorage.setItem("school_auth", "student");
        document.getElementById("loginPage").style.display = "none";
        document.getElementById("mainPage").style.display = "block";
        loadSummaries();
      } else if (password === "Admin123") {
        userRole = "admin";
        sessionStorage.setItem("school_auth", "admin");
        document.getElementById("loginPage").style.display = "none";
        document.getElementById("mainPage").style.display = "block";
        document.getElementById("postForm").style.display = "block"; // show posting form
        loadSummaries();
      } else {
        alert("Wrong password!");
      }
    }

    async function loadSummaries() {
      const container = document.getElementById("summaries-container");
      container.innerHTML = "";
      const snap = await getDocs(collection(db, "summaries"));

      if (snap.empty) {
        container.innerHTML = "<p>No summaries yet.</p>";
      } else {
        snap.forEach((docSnap) => {
          const data = docSnap.data();
          const id = docSnap.id;

          let html = `
            <div class="summary">
              <p><strong>üìÖ Date:</strong> ${data.date || ""}</p>
              <p><strong>üìò Subject:</strong> ${data.subject || ""}</p>
              <p><strong>üìñ Page:</strong> ${data.page || ""}</p>
              <p><strong>üìù Summary:</strong> ${data.text || ""}</p>
              <p><strong>üìÇ Exercise:</strong> ${data.exercise || ""}</p>
              ${data.imageUrl ? `<img src="${data.imageUrl}">` : ""}
          `;

          if (userRole === "admin") {
            html += `<button class="delete-btn" onclick="deleteSummary('${id}')">üóëÔ∏è Delete</button>`;
          }

          html += `</div>`;
          container.innerHTML += html;
        });
      }
    }

    window.deleteSummary = async function(id) {
      if (confirm("Are you sure you want to delete this summary?")) {
        await deleteDoc(doc(db, "summaries", id));
        alert("Deleted!");
        loadSummaries();
      }
    }

    document.getElementById("postBtn").addEventListener("click", async () => {
      const date = document.getElementById("date").value;
      const subject = document.getElementById("subject").value;
      const page = document.getElementById("page").value;
      const exercise = document.getElementById("exercise").value;
      const text = document.getElementById("text").value;
      const file = document.getElementById("image").files[0];

      let imageUrl = "";
      if (file) {
        const storageRef = ref(storage, "summaries/" + Date.now() + "_" + file.name);
        await uploadBytes(storageRef, file);
        imageUrl = await getDownloadURL(storageRef);
      }

      await addDoc(collection(db, "summaries"), {
        date, subject, page, exercise, text, imageUrl
      });

      alert("Summary posted!");
      loadSummaries();
    });
  </script>
</body>
</html>
